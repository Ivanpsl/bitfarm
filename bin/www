#!/usr/bin/env node
process.env.NODE_TLS_REJECT_UNAUTHORIZED = "0" /// TODO ------> SOLUCIONAR ERROR  Error: DEPTH_ZERO_SELF_SIGNED_CERT al solicitar nodos

const config = require("config");
const FarmChainService = require("../blockchain/farmChainService");



if(config.get("WebServer.run_server")){
    const webApp = require("../webServer/app")
    //MÃ³dulo para los certificados de seguridad HTTP.
    const fs = require('fs');
    const https = require('https');

    
    const httpsServer = https.createServer({key: fs.readFileSync('certificates/key.pem'), cert: fs.readFileSync('certificates/cert.pem')}, webApp);
    httpsServer.listen(config.get("WebServer.port"), function () {
        console.log("\x1b[33m%s\x1b[0m","[www] Servidor web activo en: "+"https://localhost:"+httpsServer.address().port);
        
        webApp.set('blockchainService',  new FarmChainService());
        webApp.get('webService').suscribeToBlockchain(webApp.get('blockchainService'));
        
    });
}else if(config.get("Blockchain.run_node")){
    const farmChainService = new FarmChainService();

}
